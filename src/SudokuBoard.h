#ifndef __sudoku_sudokuboard_h__
#define __sudoku_sudokuboard_h__

////////////////////////////////////////////////////////////////////////////////////////////////////
/// \brief Declaration of SudokuBoard.
/// \author anon.
////////////////////////////////////////////////////////////////////////////////////////////////////

#include <algorithm>
#include <boost/shared_ptr.hpp>
#include <vector>

#include "SudokuGridPoint.h"

namespace sudoku
{

////////////////////////////////////////////////////////////////////////////////////////////////////
/// \brief SudokuBoard contains methods for manipulating a Sudoku board.
////////////////////////////////////////////////////////////////////////////////////////////////////
class SudokuBoard
{
  public:
    ////////////////////////////////////////////////////////////////////////////////////////////////
    /// \brief SudokuBoard constructor.
    /// \param initialBoard, the initial sudoku board.
    ////////////////////////////////////////////////////////////////////////////////////////////////
    SudokuBoard(const short (&initialBoard)[9][9]);

    ////////////////////////////////////////////////////////////////////////////////////////////////
    /// \brief Returns if board is valid (i.e. there is not two or more of same number in
    /// same row, column or 3*3 square).
    /// \return true if board is valid, false otherwise.
    ////////////////////////////////////////////////////////////////////////////////////////////////
    bool isValidBoard()
    {
      return validBoard_;
    }
    
    ////////////////////////////////////////////////////////////////////////////////////////////////
    /// \brief Returns if board is solvable.
    /// \return true if board is solvable, false otherwise.
    ////////////////////////////////////////////////////////////////////////////////////////////////
    bool isBoardSolvable()
    {
      return boardSolvable_;
    }
    
    ////////////////////////////////////////////////////////////////////////////////////////////////
    /// \brief Gets the current state of the Sudoku Board.
    /// \return The Sudoku Board.
    ////////////////////////////////////////////////////////////////////////////////////////////////
    std::vector<SudokuGridPoint> getSudokuBoard() const
    {
      return sudokuBoard_;
    }

    ////////////////////////////////////////////////////////////////////////////////////////////////
    /// \brief Solves the Sudoku board.
    ////////////////////////////////////////////////////////////////////////////////////////////////
    void solveBoard();

    ////////////////////////////////////////////////////////////////////////////////////////////////
    /// \brief Gets the SudokuGridPoint at x and y.
    /// \return The SudokuGridPoint at x and y.
    /// \throws invalid_argument if x and y outside valid range.
    ////////////////////////////////////////////////////////////////////////////////////////////////
    SudokuGridPoint getSudokuGridPoint(short x, short y) const
    {
      // Let this do the work of checking the bounds of x and y.
      SudokuGridPoint check(x, y, 1); 

      // If x and y are ok then we can continue.
      for ( auto &sgp : sudokuBoard_ )
      {
        if ( x == sgp.getX() && y == sgp.getY() )
        {
          return sgp;
        }
      }

      // If we haven't found the SudokuGridPoint that is a logic error.
      throw std::logic_error("Couldn't find SudokuGridPoint with valid x and y passed.");
    }

  /// Private Methods.
  private:
    ////////////////////////////////////////////////////////////////////////////////////////////////
    /// \brief Checks the values in the initial board are ok.
    /// \param initialBoard The initial sudoku board.
    /// \throws invalid_argument If any of the values are outside the range 0 to 9.
    ////////////////////////////////////////////////////////////////////////////////////////////////
    void checkBoardValues_( const short (&initialBoard)[9][9] ) const;

    ////////////////////////////////////////////////////////////////////////////////////////////////
    /// \brief Populates our Sudoku Board (vector of SudokuGridPoint).
    /// \param initialBoard The initial sudoku board.
    ////////////////////////////////////////////////////////////////////////////////////////////////
    void populateSudokuBoard_( const short (&initialBoard)[9][9] );  

    ////////////////////////////////////////////////////////////////////////////////////////////////
    /// \brief Method that is recursively called until the Sudoku Board is solved, or not if the
    /// Sudoku board is not solvable.
    /// \param currentIndex All SudokuGridPoints in the SudokuBoard with index less than or equal
    /// to this index have a value, which could be a result of guessing these values.
    ////////////////////////////////////////////////////////////////////////////////////////////////
    void solveBoard_( unsigned int currentIndex );

  /// Private variables.
  private:
    bool validBoard_; // Indicates if board is valid.
    bool boardSolvable_; // Indicates if the board is solved.
    std::vector<SudokuGridPoint> sudokuBoard_; // sudoku board, will be returned.
};
 
} // End of namespace sudoku.

#endif
